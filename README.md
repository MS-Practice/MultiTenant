# 如何自行实现一个多租户系统

现如今框架满天飞的环境下，好像很少机会需要自己来实现一个模块。毕竟这样能节省很多的开发时间，提高效率。

这就是框架的好处，也是我们使用框架的直接原因。

情况总有例外，假设刚好我们公司没有用到框架，用的就是 .netcore 平台新建项目，直接开干一把唆。由于前期工作没有考虑周全，现在发现公司新建的平台项目的业务数据越来越大，提供给用户的数量越来越多。但是这些不同的用户的数据肯定不能互相干扰。

举个例子说明，例如我举个跟我公司接近的一种情况，公司再搭建数据平台，来给不同学校提供资料。并且我们的数据平台要记录合作学校对应的学生和老师。前面有假设提到公司前期考虑不周，我们把所有的学校放在 school 表中，所有学生放在 student 表中。所有老师放在 teacher 表中。这样当公司系统在给他们（用户）提供数据的时候，是不是每次都要判断当前用户在哪个学校，然后再把对应的学校资料推送给他们。不仅如此，对数据敏感的增删改操作对这种混在一起数据要各位小心。一不小心，可能就会发生误删其他学校的信息。

为了有效的解决这个问题，我们第一要做的就是要将数据分开管理，彼此互不干扰。这是我们要实现的最终目的。

想要的效果有了，现在的问题是能不能实现，该如何实现，怎么实现才算好。

我们做事情的目的就是解决问题，在前面我们分析了我们要把数据在一个系统中隔离。那么我们自然能想到的就是以学校为领域划分为不同的库。这样我们在系统运行的时候就能做到在用户选择对应的学校登陆系统时，就只能访问这个学校的所有信息了。

到这里，我们就很清晰了，如果我们平时多看多听到别人谈论新的知识点或框架时，我们就会知道对于这种情况，“多租户”就是为了这种情况而诞生的。

既然要做 “多租户” 系统，并且团队之间没有使用市面上的多租户框架。那么我们就得自己实现一个了。那么要做的第一件就是要了解 “多租户” 的概念。正所谓知己知彼，方能战无不胜。

# 什么是多租户

我们来看下维基百科对多租户的定义是什么（以下是概述）

多租户软件架构就是在同一个系统实例上运行不同用户，能做到应用程序共享，服务自治，并且还能做到数据互相隔离的软件架构思想。一个租户就相当于一组用户（比如针对学校来说，一个学校就是一个租户，这个租户下有学生，老师作为用户（一组用户））。

现在我们总结一下我们要做什么？

我们要实现：

1. 相同的应用程序 app 下
2. 解析出登陆系统的（当前用户）是属于哪一个租户（对应到例子就是学校）。
3. 根据解析出来的租户信息，来访问对应的数据库信息。

现在我们就来实现上面说的步骤。第一步不用想，肯定要得一个 app 下。

# 解析租户信息

现在我们要设计如何才能让系统检测到当前用户的租户信息。

现阶段我们能想到的解析方式有三种：

1. 域名：例如 tenant1.example.com，tenant2.example.com
2. URL：例如 www.example.com/tenant1/，www.example.com/tenant2
3. header：例如 [x-header: 'tenant1']，[x-header: 'tenant2']

一下子有这么多解决方式，是不是自信心起来了，有木有。

# 解析出来租户，那就存储下来





